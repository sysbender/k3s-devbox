{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.10.7/.schema/devbox.schema.json",
  "packages": [
    "envsubst@latest",
    "gh@latest",
    "go@latest",
    "go-task@latest",
    "gum@latest",
    "jq@latest",
    "k9s@latest",
    "k3s@latest", 
    "kluctl@latest",
    "ko@latest",
    "kubectl@latest",
    "kubectx@latest",
    "kubernetes-helm@latest",
    "kustomize@latest",
    "oras@latest",
    "nodejs_20@latest",
    "poetry@latest",
    "python312@latest",
    "tilt@latest",
    "yq-go@latest",
    "act@latest",
    "kubent@latest",
    "terraform@latest",
    "frp@latest"
  ],
  "shell": {
    "init_hook": [
      "export GOBIN=$(git rev-parse --show-toplevel)/bin",
      "export PATH=$GOBIN:$PATH",
      "go install sigs.k8s.io/cloud-provider-k3s@v0.2.0",
      "export FRP_CONFIG_PATH=$(git rev-parse --show-toplevel)/frp_config.ini",
      "export $(cat .env | xargs)"  // Load .env file environment variables
    ],
    "scripts": {
      "test": ["echo \"Error: no test specified\" && exit 1"],
      "start-k3s": [
        "echo 'Starting K3s one-node cluster...'",
        "curl -sfL https://get.k3s.io | sh -",
        "export KUBEVERSION=$(kubectl version --short | awk -F ': ' 'NR==1 {print $2}')",
        "echo 'K3s cluster started with version $KUBEVERSION'"
      ],
      "start-frp": [
        "echo 'Starting FRP client...'",
        "cat > $FRP_CONFIG_PATH <<EOF",
        "[common]",
        "server_addr = $FRP_SERVER_ADDR",
        "server_port = 7000",  
        "token = $FRP_AUTH_TOKEN",
        "[http]",
        "type = tcp",
        "local_ip = 127.0.0.1",
        "local_port = 8080",
        "remote_port = 8080",
        "EOF",
        "frp -c $FRP_CONFIG_PATH"
      ]
    }
  }
}
